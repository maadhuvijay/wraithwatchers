<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 0da1c3a8-79ca-4b8d-94d6-42376c7c1fbd (2025-12-08 13:06Z) -->

# Background image loads before main page (2025-12-08 13:06Z)

_**User (2025-12-08 13:06Z)**_

when the application is loading, the background image is loading first  and the main page loads on top of it a coupse seconds later. why does this happen?

---

_**Agent (model default, mode Agent)**_



---


Investigating why the background image loads before the main content. Examining the codebase structure and loading logic.


---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "How is the background image loaded and rendered in the application?" • **12** results</summary>
            
| File | Lines |
|------|-------|
| `app/page.tsx` | L10-170 |
| `app/page.tsx` | L170 |
| `app/globals.css` | L35 |
| `app/post/page.tsx` | L6-207 |
| `app/lib/loadSightings.ts` | L18 |
| `app/components/SightingPopup.tsx` | L1-67 |
| `app/confirmation/page.tsx` | L33 |
| `app/components/SightingsMap.tsx` | L5-165 |
| `app/components/LocationMap.tsx` | L8-173 |
| `README.md` | L68 |
| `.next/dev/server/chunks/ssr/node_modules_ae1fc6df._.js` | L8493-9035 |
| `app/components/Navbar.tsx` | L2-37 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "Where is the main page content rendered and how is it loaded?" • **9** results</summary>
            
| File | Lines |
|------|-------|
| `app/page.tsx` | L10-170 |
| `app/page.tsx` | L170 |
| `app/layout.tsx` | L10-30 |
| `app/post/page.tsx` | L6-207 |
| `app/lib/loadSightings.ts` | L18 |
| `README.md` | L68 |
| `app/confirmation/page.tsx` | L33 |
| `app/post/page.tsx` | L207 |
| `app/components/Navbar.tsx` | L2-37 |

</details>
</tool-use>

---



---


Reading the full `page.tsx` to understand the loading flow:


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: app/page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: app/layout.tsx</summary>

</details>
</tool-use>

---



---


The background image is in the loading div, which unmounts when data loads, causing a visual pop. Keeping a single container with the background and conditionally rendering the loading state or main content inside it. Implementing the fix:


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: app/page.tsx</summary>

**Chunk 1**
Lines added: undefined, lines removed: 16

```diff
@@ -106,20 +106,4 @@
      return sightings;
    }
- 
-   if (loading) {
-     return (
-       &lt;div 
-         className="min-h-screen bg-[#5D5D5D] text-black flex items-center justify-center"
-         style={{
-           backgroundImage: 'url(/ghost3.png)',
-           backgroundSize: 'cover',
-           backgroundPosition: 'center',
-           backgroundRepeat: 'no-repeat'
-         }}
-       &gt;
-         &lt;p&gt;Loading sightings...&lt;/p&gt;
-       &lt;/div&gt;
-     );
-   }
  
    return (
```

**Chunk 2**
Lines added: 38, lines removed: 30

```diff
@@ -133,38 +117,46 @@
        }}
      &gt;
-       &lt;Navbar activePage="sightings" /&gt;
-       
-       &lt;main className="flex-1 p-4 md:p-8 max-w-7xl mr-auto w-full"&gt;
-         &lt;div className="flex flex-col gap-2 mb-6"&gt;
-           &lt;h1 className="text-3xl font-bold text-[#F79486]"&gt;Buckeye Sighting Stats&lt;/h1&gt;
-           &lt;p className="text-lg text-white"&gt;Track paranormal activity across Ohio&lt;/p&gt;
-         &lt;/div&gt;
-         &lt;StatsCards stats={stats} /&gt;
-         
-         &lt;div className="mb-6"&gt;
-           &lt;h2 className="text-2xl font-bold mb-4 text-[#F79486]"&gt;Sightings Map&lt;/h2&gt;
-           &lt;SightingsMap
-             sightings={filteredSightings}
-             selectedSighting={selectedSighting}
-             onMarkerClick={setSelectedSighting}
-           /&gt;
-         &lt;/div&gt;
+       {loading ? (
+         &lt;div className="flex-1 flex items-center justify-center"&gt;
+           &lt;p&gt;Loading sightings...&lt;/p&gt;
+         &lt;/div&gt;
+       ) : (
+         &lt;&gt;
+           &lt;Navbar activePage="sightings" /&gt;
+           
+           &lt;main className="flex-1 p-4 md:p-8 max-w-7xl mr-auto w-full"&gt;
+             &lt;div className="flex flex-col gap-2 mb-6"&gt;
+               &lt;h1 className="text-3xl font-bold text-[#F79486]"&gt;Buckeye Sighting Stats&lt;/h1&gt;
+               &lt;p className="text-lg text-white"&gt;Track paranormal activity across Ohio&lt;/p&gt;
+             &lt;/div&gt;
+             &lt;StatsCards stats={stats} /&gt;
+             
+             &lt;div className="mb-6"&gt;
+               &lt;h2 className="text-2xl font-bold mb-4 text-[#F79486]"&gt;Sightings Map&lt;/h2&gt;
+               &lt;SightingsMap
+                 sightings={filteredSightings}
+                 selectedSighting={selectedSighting}
+                 onMarkerClick={setSelectedSighting}
+               /&gt;
+             &lt;/div&gt;
  
-         &lt;FilterControlPanel 
-           sightings={sightings}
-           onFilterChange={setFilteredSightings}
-         /&gt;
+             &lt;FilterControlPanel 
+               sightings={sightings}
+               onFilterChange={setFilteredSightings}
+             /&gt;
  
-         &lt;SightingsTable sightings={filteredSightings} /&gt;
-       &lt;/main&gt;
+             &lt;SightingsTable sightings={filteredSightings} /&gt;
+           &lt;/main&gt;
  
-       {selectedSighting &amp;&amp; (
-         &lt;SightingPopup
-           sighting={selectedSighting}
-           onClose={() =&gt; setSelectedSighting(null)}
-         /&gt;
-       )}
+           {selectedSighting &amp;&amp; (
+             &lt;SightingPopup
+               sighting={selectedSighting}
+               onClose={() =&gt; setSelectedSighting(null)}
+             /&gt;
+           )}
  
-       &lt;Footer /&gt;
+           &lt;Footer /&gt;
+         &lt;/&gt;
+       )}
      &lt;/div&gt;
    );
```

</details>

</tool-use>

---



---


Checking for linting errors:


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `app/page.tsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---



---


## The Problem

The component had two separate return statements:
1. A loading screen with the background image
2. The main content with the same background image

When data finished loading, React unmounted the loading div and mounted the main content div. This caused:
- The background image to load immediately (in the loading div)
- The main content to appear a few seconds later (after the API call)
- A visual "pop" as the background container was replaced

## The Solution

I refactored it to use a single container div that stays mounted throughout. The background image is set on this container, and we conditionally render either:
- The loading message (while data is fetching)
- The main content (once data is loaded)

This ensures:
- The background image loads once and stays consistent
- No unmounting/remounting of the background container
- Smoother transition from loading to loaded state
- The main content appears on top of the already-loaded background

The background image now loads once and remains stable, while only the inner content changes when data is ready.

---

